<% layout("/layouts/boilerplate") %>

<style>
    :root {
        --primary-color: #FF385C;
        --primary-hover: #E31C5F;
        --text-primary: #222222;
        --text-secondary: #717171;
        --border-color: #DDDDDD;
        --background-gray: #F7F7F7;
        --card-shadow: 0 6px 16px rgba(0, 0, 0, 0.12);
        --transition-fast: 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        --transition-medium: 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }

    * {
        box-sizing: border-box;
    }

    body {
        overflow-x: hidden;
    }

    /* ===== FILTERS SECTION ===== */
    .filters-wrapper {
        position: sticky;
        top: 65px;
        z-index: 100;
        background: white;
        border-bottom: 1px solid var(--border-color);
        width: 100%;
    }

    .filters-container {
        max-width: 1280px;
        margin: 0 auto;
        padding: 1rem 1.5rem;
        display: flex;
        align-items: center;
        gap: 1rem;
    }

    /* Filters Scroll Area */
    .filters-scroll-wrapper {
        flex: 1;
        position: relative;
        overflow: hidden;
        min-width: 0;
    }

    .filters-scroll {
        display: flex;
        gap: 2rem;
        overflow-x: auto;
        scroll-behavior: smooth;
        -webkit-overflow-scrolling: touch;
        scrollbar-width: none;
        -ms-overflow-style: none;
        padding: 0.5rem 0;
    }

    .filters-scroll::-webkit-scrollbar {
        display: none;
    }

    /* Fade edges */
    .filters-scroll-wrapper::before,
    .filters-scroll-wrapper::after {
        content: '';
        position: absolute;
        top: 0;
        bottom: 0;
        width: 40px;
        z-index: 2;
        pointer-events: none;
    }

    .filters-scroll-wrapper::before {
        left: 0;
        background: linear-gradient(to right, white 30%, transparent);
        opacity: 0;
        transition: opacity var(--transition-fast);
    }

    .filters-scroll-wrapper::after {
        right: 0;
        background: linear-gradient(to left, white 30%, transparent);
    }

    .filters-scroll-wrapper.scrolled-left::before {
        opacity: 1;
    }

    .filters-scroll-wrapper.scrolled-end::after {
        opacity: 0;
    }

    /* Individual Filter */
    .filter {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 0.5rem;
        min-width: 56px;
        padding: 0.5rem 0.25rem;
        cursor: pointer;
        border-radius: 8px;
        transition: all var(--transition-fast);
        position: relative;
        flex-shrink: 0;
        opacity: 0.7;
    }

    .filter::after {
        content: '';
        position: absolute;
        bottom: 0;
        left: 50%;
        transform: translateX(-50%) scaleX(0);
        width: 100%;
        height: 2px;
        background: var(--text-primary);
        transition: transform var(--transition-fast);
    }

    .filter:hover,
    .filter.active {
        opacity: 1;
    }

    .filter:hover::after,
    .filter.active::after {
        transform: translateX(-50%) scaleX(1);
    }

    .filter i {
        font-size: 1.5rem;
        color: var(--text-secondary);
        transition: color var(--transition-fast);
    }

    .filter p {
        font-size: 0.75rem;
        color: var(--text-secondary);
        margin: 0;
        white-space: nowrap;
        font-weight: 500;
        transition: color var(--transition-fast);
    }

    .filter:hover i,
    .filter:hover p,
    .filter.active i,
    .filter.active p {
        color: var(--text-primary);
    }

    /* Tax Toggle */
    .tax-toggle {
        display: flex;
        align-items: center;
        gap: 0.75rem;
        padding: 0.75rem 1rem;
        border: 1px solid var(--border-color);
        border-radius: 12px;
        background: white;
        cursor: pointer;
        transition: all var(--transition-fast);
        flex-shrink: 0;
        white-space: nowrap;
    }

    .tax-toggle:hover {
        border-color: var(--text-primary);
    }

    .tax-toggle label {
        font-size: 0.8rem;
        font-weight: 500;
        color: var(--text-primary);
        cursor: pointer;
    }

    /* Custom Toggle Switch */
    .toggle-switch {
        position: relative;
        width: 44px;
        height: 26px;
        flex-shrink: 0;
    }

    .toggle-switch input {
        opacity: 0;
        width: 0;
        height: 0;
    }

    .toggle-slider {
        position: absolute;
        cursor: pointer;
        inset: 0;
        background-color: var(--border-color);
        border-radius: 26px;
        transition: all var(--transition-medium);
    }

    .toggle-slider::before {
        content: '';
        position: absolute;
        height: 20px;
        width: 20px;
        left: 3px;
        bottom: 3px;
        background-color: white;
        border-radius: 50%;
        transition: all var(--transition-medium);
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
    }

    .toggle-switch input:checked + .toggle-slider {
        background: var(--text-primary);
    }

    .toggle-switch input:checked + .toggle-slider::before {
        transform: translateX(18px);
    }

    /* ===== MOBILE FILTER STYLES ===== */
    @media (max-width: 992px) {
        .filters-wrapper {
            top: 58px;
        }

        .filters-container {
            padding: 0.75rem 1rem;
            gap: 0.75rem;
        }

        .filters-scroll {
            gap: 1.5rem;
        }

        .filter {
            min-width: 48px;
        }

        .filter i {
            font-size: 1.35rem;
        }

        .filter p {
            font-size: 0.7rem;
        }

        .tax-toggle label {
            font-size: 0.75rem;
        }
    }

    @media (max-width: 768px) {
        .filters-wrapper {
            top: 54px;
        }

        .filters-container {
            flex-direction: column;
            padding: 0.5rem 0.75rem;
            gap: 0.5rem;
        }

        .filters-scroll-wrapper {
            width: 100%;
        }

        .filters-scroll {
            gap: 1.25rem;
            padding: 0.25rem 0;
        }

        .filter {
            min-width: 44px;
            gap: 0.35rem;
        }

        .filter i {
            font-size: 1.25rem;
        }

        .filter p {
            font-size: 0.65rem;
        }

        .tax-toggle {
            width: 100%;
            justify-content: center;
            padding: 0.625rem 0.75rem;
        }

        .toggle-switch {
            width: 40px;
            height: 24px;
        }

        .toggle-slider::before {
            height: 18px;
            width: 18px;
        }

        .toggle-switch input:checked + .toggle-slider::before {
            transform: translateX(16px);
        }
    }

    @media (max-width: 480px) {
        .filters-container {
            padding: 0.5rem;
        }

        .filters-scroll {
            gap: 1rem;
        }

        .filter {
            min-width: 40px;
        }

        .filter i {
            font-size: 1.1rem;
        }

        .filter p {
            font-size: 0.6rem;
        }

        .filters-scroll-wrapper::before,
        .filters-scroll-wrapper::after {
            width: 24px;
        }
    }

    /* ===== LISTINGS GRID ===== */
    .listings-wrapper {
        max-width: 1280px;
        margin: 0 auto;
        padding: 1.5rem;
    }

    .listings-grid {
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        gap: 1.5rem;
    }

    @media (max-width: 1200px) {
        .listings-grid {
            grid-template-columns: repeat(3, 1fr);
        }
    }

    @media (max-width: 900px) {
        .listings-grid {
            grid-template-columns: repeat(2, 1fr);
            gap: 1.25rem;
        }

        .listings-wrapper {
            padding: 1rem;
        }
    }

    @media (max-width: 600px) {
        .listings-grid {
            grid-template-columns: 1fr;
            gap: 1.5rem;
        }

        .listings-wrapper {
            padding: 1rem 0.75rem;
        }
    }

    /* Listing Card */
    .listing-link {
        text-decoration: none;
        color: inherit;
    }

    .listing-card {
        background: white;
        border-radius: 16px;
        overflow: hidden;
        transition: all var(--transition-medium);
        position: relative;
        border: none;
        box-shadow: none;
    }

    .listing-card:hover {
        transform: translateY(-4px);
    }

    /* Card Image Container */
    .card-image-container {
        position: relative;
        aspect-ratio: 1/1;
        overflow: hidden;
        border-radius: 16px;
    }

    .card-image {
        width: 100%;
        height: 100%;
        object-fit: cover;
        transition: transform 0.5s ease;
    }

    .listing-card:hover .card-image {
        transform: scale(1.05);
    }

    /* Wishlist Button */
    .wishlist-btn {
        position: absolute;
        top: 12px;
        right: 12px;
        width: 32px;
        height: 32px;
        border: none;
        background: transparent;
        cursor: pointer;
        z-index: 10;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: transform var(--transition-fast);
    }

    .wishlist-btn:hover {
        transform: scale(1.1);
    }

    .wishlist-btn i {
        font-size: 1.5rem;
        color: rgba(0, 0, 0, 0.5);
        -webkit-text-stroke: 2px white;
        transition: all var(--transition-fast);
    }

    .wishlist-btn.active i {
        color: var(--primary-color);
        -webkit-text-stroke: 0;
    }

    /* Guest Favorite Badge */
    .guest-favorite {
        position: absolute;
        top: 12px;
        left: 12px;
        background: white;
        padding: 4px 10px;
        border-radius: 20px;
        font-size: 0.7rem;
        font-weight: 600;
        color: var(--text-primary);
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }

    /* Card Body */
    .card-body {
        padding: 12px 2px;
    }

    .card-header-row {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        margin-bottom: 2px;
    }

    .card-title {
        font-size: 0.95rem;
        font-weight: 600;
        color: var(--text-primary);
        margin: 0;
        line-height: 1.3;
        display: -webkit-box;
        -webkit-line-clamp: 1;
        -webkit-box-orient: vertical;
        overflow: hidden;
        flex: 1;
        margin-right: 0.5rem;
    }

    .card-rating {
        display: flex;
        align-items: center;
        gap: 4px;
        font-size: 0.875rem;
        flex-shrink: 0;
    }

    .card-rating i {
        font-size: 0.75rem;
        color: var(--text-primary);
    }

    .card-rating span {
        font-weight: 500;
    }

    .card-location {
        font-size: 0.875rem;
        color: var(--text-secondary);
        margin: 2px 0;
    }

    .card-distance {
        font-size: 0.875rem;
        color: var(--text-secondary);
        margin: 2px 0;
    }

    .card-price {
        margin-top: 6px;
        display: flex;
        align-items: baseline;
        flex-wrap: wrap;
        gap: 4px;
    }

    .price-amount {
        font-weight: 600;
        font-size: 0.95rem;
        color: var(--text-primary);
    }

    .price-period {
        font-size: 0.95rem;
        color: var(--text-primary);
    }

    .tax-info {
        font-size: 0.8rem;
        color: var(--text-secondary);
        display: none;
    }

    .tax-info.show {
        display: inline;
    }

    /* ===== ANIMATIONS ===== */
    @keyframes fadeInUp {
        from {
            opacity: 0;
            transform: translateY(20px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    .listing-card {
        animation: fadeInUp 0.5s ease forwards;
        opacity: 0;
    }

    .listings-grid .listing-link:nth-child(1) .listing-card { animation-delay: 0.05s; }
    .listings-grid .listing-link:nth-child(2) .listing-card { animation-delay: 0.1s; }
    .listings-grid .listing-link:nth-child(3) .listing-card { animation-delay: 0.15s; }
    .listings-grid .listing-link:nth-child(4) .listing-card { animation-delay: 0.2s; }
    .listings-grid .listing-link:nth-child(5) .listing-card { animation-delay: 0.25s; }
    .listings-grid .listing-link:nth-child(6) .listing-card { animation-delay: 0.3s; }
    .listings-grid .listing-link:nth-child(7) .listing-card { animation-delay: 0.35s; }
    .listings-grid .listing-link:nth-child(8) .listing-card { animation-delay: 0.4s; }

    /* No Results */
    .no-results {
        text-align: center;
        padding: 4rem 2rem;
        grid-column: 1 / -1;
    }

    .no-results i {
        font-size: 4rem;
        color: var(--border-color);
        margin-bottom: 1rem;
    }

    .no-results h3 {
        color: var(--text-primary);
        margin-bottom: 0.5rem;
    }

    .no-results p {
        color: var(--text-secondary);
    }
</style>

<body>
    <!-- Filters Section -->
    <div class="filters-wrapper">
        <div class="filters-container">
            <div class="filters-scroll-wrapper" id="filtersWrapper">
                <div class="filters-scroll" id="filtersScroll">
                    <div class="filter active" data-category="trending">
                        <i class="fa-solid fa-fire"></i>
                        <p>Trending</p>
                    </div>
                    <div class="filter" data-category="rooms">
                        <i class="fa-solid fa-bed"></i>
                        <p>Rooms</p>
                    </div>
                    <div class="filter" data-category="iconic-cities">
                        <i class="fa-solid fa-mountain-city"></i>
                        <p>Iconic cities</p>
                    </div>
                    <div class="filter" data-category="mountains">
                        <i class="fa-solid fa-mountain"></i>
                        <p>Mountains</p>
                    </div>
                    <div class="filter" data-category="castles">
                        <i class="fa-brands fa-fort-awesome"></i>
                        <p>Castles</p>
                    </div>
                    <div class="filter" data-category="pools">
                        <i class="fa-solid fa-person-swimming"></i>
                        <p>Amazing pools</p>
                    </div>
                    <div class="filter" data-category="camping">
                        <i class="fa-solid fa-campground"></i>
                        <p>Camping</p>
                    </div>
                    <div class="filter" data-category="farms">
                        <i class="fa-solid fa-cow"></i>
                        <p>Farms</p>
                    </div>
                    <div class="filter" data-category="arctic">
                        <i class="fa-regular fa-snowflake"></i>
                        <p>Arctic</p>
                    </div>
                    <div class="filter" data-category="domes">
                        <i class="fa-solid fa-igloo"></i>
                        <p>Domes</p>
                    </div>
                    <div class="filter" data-category="boats">
                        <i class="fa-solid fa-sailboat"></i>
                        <p>Boats</p>
                    </div>
                    <div class="filter" data-category="beach">
                        <i class="fa-solid fa-umbrella-beach"></i>
                        <p>Beachfront</p>
                    </div>
                    <div class="filter" data-category="lakefront">
                        <i class="fa-solid fa-water"></i>
                        <p>Lakefront</p>
                    </div>
                    <div class="filter" data-category="design">
                        <i class="fa-solid fa-gem"></i>
                        <p>Design</p>
                    </div>
                    <div class="filter" data-category="tropical">
                        <i class="fa-solid fa-tree"></i>
                        <p>Tropical</p>
                    </div>
                </div>
            </div>

            <div class="tax-toggle">
                <label class="toggle-switch">
                    <input type="checkbox" id="taxToggle">
                    <span class="toggle-slider"></span>
                </label>
                <label for="taxToggle">Display total after taxes</label>
            </div>
        </div>
    </div>

    <!-- Listings Grid -->
    <div class="listings-wrapper">
        <% if (allListings && allListings.length > 0) { %>
            <div class="listings-grid">
                <% for(let i = 0; i < allListings.length; i++) { 
                    let listing = allListings[i]; %>
                    <a href="/listings/<%= listing._id %>" class="listing-link">
                        <div class="listing-card">
                            <div class="card-image-container">
                                <img 
                                    src="<%= listing.image.url %>" 
                                    class="card-image" 
                                    alt="<%= listing.title %>"
                                    loading="lazy"
                                >
                                
                                <button class="wishlist-btn" onclick="toggleWishlist(event, this)">
                                    <i class="fa-regular fa-heart"></i>
                                </button>
                                
                                <% if (i % 5 === 0) { %>
                                    <span class="guest-favorite">Guest favourite</span>
                                <% } %>
                            </div>
                            
                            <div class="card-body">
                                <div class="card-header-row">
                                    <h5 class="card-title"><%= listing.title %></h5>
                                    <div class="card-rating">
                                        <i class="fa-solid fa-star"></i>
                                        <span><%= (4 + Math.random()).toFixed(2) %></span>
                                    </div>
                                </div>
                                <p class="card-location"><%= listing.location %>, <%= listing.country %></p>
                                <p class="card-distance"><%= Math.floor(Math.random() * 500) + 50 %> kilometres away</p>
                                <div class="card-price">
                                    <span class="price-amount">â‚¹<%= listing.price.toLocaleString("en-IN") %></span>
                                    <span class="price-period">night</span>
                                    <span class="tax-info">&nbsp;+18% GST</span>
                                </div>
                            </div>
                        </div>
                    </a>
                <% } %>
            </div>
        <% } else { %>
            <div class="no-results">
                <i class="fa-solid fa-search"></i>
                <h3>No results found</h3>
                <p>Try adjusting your filters or search criteria</p>
            </div>
        <% } %>
    </div>

    <script>
        // Filter functionality
        const filters = document.querySelectorAll('.filter');
        const filtersScroll = document.getElementById('filtersScroll');
        const filtersWrapper = document.getElementById('filtersWrapper');

        filters.forEach(filter => {
            filter.addEventListener('click', function() {
                filters.forEach(f => f.classList.remove('active'));
                this.classList.add('active');
                
                const category = this.dataset.category;
                console.log('Filter by:', category);
            });
        });

        // Scroll fade effect
        function updateScrollFade() {
            const { scrollLeft, scrollWidth, clientWidth } = filtersScroll;
            
            if (scrollLeft > 10) {
                filtersWrapper.classList.add('scrolled-left');
            } else {
                filtersWrapper.classList.remove('scrolled-left');
            }
            
            if (scrollLeft >= scrollWidth - clientWidth - 10) {
                filtersWrapper.classList.add('scrolled-end');
            } else {
                filtersWrapper.classList.remove('scrolled-end');
            }
        }

        filtersScroll.addEventListener('scroll', updateScrollFade);
        window.addEventListener('resize', updateScrollFade);
        updateScrollFade();

        // Tax Toggle
        const taxToggle = document.getElementById('taxToggle');
        const taxInfos = document.querySelectorAll('.tax-info');

        taxToggle.addEventListener('change', function() {
            taxInfos.forEach((info, index) => {
                setTimeout(() => {
                    info.classList.toggle('show', this.checked);
                }, index * 30);
            });
        });

        // Wishlist Toggle
        function toggleWishlist(event, button) {
            event.preventDefault();
            event.stopPropagation();
            
            const icon = button.querySelector('i');
            button.classList.toggle('active');
            
            if (button.classList.contains('active')) {
                icon.classList.remove('fa-regular');
                icon.classList.add('fa-solid');
            } else {
                icon.classList.remove('fa-solid');
                icon.classList.add('fa-regular');
            }
        }
    </script>
</body>
